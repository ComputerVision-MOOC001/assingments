name: Update Forks

on:
  workflow_dispatch:

jobs:
  update-forks:
    runs-on: ubuntu-latest
    environment: test

    steps:
      - name: Set up GitHub CLI authentication
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }} 
        run: |
          gh auth status  # Verifica que la autenticación funciona

      - name: Create pull requests in forks
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          repos=(
            ComputerVision-MOOC001/intro-computer-vision-danthb
          )
          PR_TITLE="Actualizar con los últimos cambios del template"
          PR_BODY="Se han realizado las siguientes actualizaciones:\n- Corrección de errores\n- Nuevas instrucciones para la tarea"
          for repo in "${repos[@]}"; do
            echo "Creando Pull Request para $repo"
            # Verifica si hay cambios antes de crear el Pull Request
            if gh pr diff --repo "$repo" --head "ComputerVision-MOOC001:main" --base "main" > /dev/null 2>&1; then
              gh pr create --repo "$repo" --head "ComputerVision-MOOC001:main" --base "main" \
                --title "$PR_TITLE" --body "$PR_BODY"
              echo "Pull Request creado para $repo"
            else
              echo "No hay cambios en $repo, no se creó el Pull Request."
            fi
          done
